{"openapi":"3.1.0","info":{"title":"نظام حجز قطارات الخطوط الحديدية السعودية - SAR Train Booking System","version":"2.0.0"},"paths":{"/search/cities":{"get":{"tags":["البحث والاستعلام - Search"],"summary":"Get Available Cities","description":"الحصول على جميع المدن المتاحة\n\nGet all available cities with their keys and possible destinations.\n\nEach city has:\n- name: اسم المدينة بالعربي\n- key: رمز المدينة (e.g., DMM, HAF, etc.) - الرياض has no key","operationId":"get_available_cities_search_cities_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/CityRoutesResponse"}}}}}}},"/search/destinations":{"get":{"tags":["البحث والاستعلام - Search"],"summary":"Get Destinations","description":"الحصول على الوجهات المتاحة من مدينة معينة\n\nGet available destination cities for a given origin city with city keys.\n\n**Now with dropdown selection!** Select the departure city from the list.","operationId":"get_destinations_search_destinations_get","parameters":[{"name":"from_city","in":"query","required":true,"schema":{"$ref":"#/components/schemas/CityEnum","description":"اختر مدينة المغادرة - Select departure city"},"description":"اختر مدينة المغادرة - Select departure city"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/search/trains":{"post":{"tags":["البحث والاستعلام - Search"],"summary":"Search Trains","description":"البحث عن القطارات المتاحة - مع إنشاء جلسة تلقائياً\n\nSearch for available trains and CREATE SESSION automatically.\n\n**This is Step 1 - After completion:**\n- A session_id will be generated\n- Passenger categories will be linked to the session\n- Use the session_id for all subsequent steps\n\n**Returns:**\n- session_id: Use this for booking\n- Session details: passenger categories, travel info\n- Available trains with all details\n\n**Dropdowns available for:**\n- from_city: Select from dropdown\n- to_city: Select from dropdown","operationId":"search_trains_search_trains_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/SearchRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/search/ticket-details":{"get":{"tags":["البحث والاستعلام - Search"],"summary":"Get Ticket Details","description":"الحصول على تفاصيل التذكرة\n\nGet detailed ticket information for a specific train and class before booking.\n\n**Now with dropdown selection!**\n- ticket_class: Select from dropdown (Economy, Business, Sleeper)\n- ticket_sub_class: Select from dropdown (based on main class)\n\nShows:\n- Complete train schedule\n- Price per person for the selected sub-class\n- Available seats\n- City information with keys","operationId":"get_ticket_details_search_ticket_details_get","parameters":[{"name":"train_id","in":"query","required":true,"schema":{"type":"string","description":"معرف القطار (مثال: TR001_2025-11-15)","title":"Train Id"},"description":"معرف القطار (مثال: TR001_2025-11-15)"},{"name":"ticket_class","in":"query","required":true,"schema":{"$ref":"#/components/schemas/TicketClass","description":"اختر الدرجة الرئيسية - Select main class"},"description":"اختر الدرجة الرئيسية - Select main class"},{"name":"ticket_sub_class","in":"query","required":true,"schema":{"$ref":"#/components/schemas/TicketSubClass","description":"اختر الدرجة الفرعية - Select sub-class"},"description":"اختر الدرجة الفرعية - Select sub-class"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/booking/create":{"post":{"tags":["الحجز والدفع - Booking & Payment"],"summary":"Create Booking","description":"إنشاء حجز جديد للقطار - مع التحقق من الجلسة\n\nCreate a new train booking with SESSION VALIDATION.\n\n**IMPORTANT - Session-based booking:**\n1. You MUST provide the session_id from Step 1\n2. Number of passenger forms MUST match session data\n3. Passenger types MUST match what was specified in session\n\n**Example:**\nIf session has 2 adults + 1 child:\n- You MUST submit exactly 3 passenger forms\n- 2 forms with passenger_type = \"بالغ\"\n- 1 form with passenger_type = \"طفل\"\n\n**Dropdown selections available:**\n- ticket_class: Select from dropdown\n- ticket_sub_class: Select from dropdown\n\n**Each passenger form requires:**\n- اللقب (Title): Select from dropdown\n- الاسم الكامل (Full name)\n- نوع الراكب (Type): Select from dropdown (must match session)\n- رقم الهوية (National ID)\n- تاريخ الميلاد (DOB)\n- الجنسية (Nationality)\n- البريد الإلكتروني (Email)\n- رقم الجوال (Mobile)\n\n**Returns:** Individual tickets for each passenger - Status: \"في انتظار الدفع\"","operationId":"create_booking_booking_create_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/BookingRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/BookingConfirmation"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/booking/details/{booking_id}":{"get":{"tags":["الحجز والدفع - Booking & Payment"],"summary":"Get Booking Details","description":"استرجاع تفاصيل الحجز\n\nRetrieve complete booking details including all individual tickets.","operationId":"get_booking_details_booking_details__booking_id__get","parameters":[{"name":"booking_id","in":"path","required":true,"schema":{"type":"string","title":"Booking Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/booking/payment":{"post":{"tags":["الحجز والدفع - Booking & Payment"],"summary":"Process Payment","description":"إتمام عملية الدفع\n\nProcess payment for a booking and confirm all tickets.\n\nAfter successful payment:\n- Booking status changes to \"مؤكد\" (Confirmed)\n- All tickets are confirmed with status \"مؤكد\"\n- Seat availability is updated\n- Payment confirmation with all ticket details is returned\n\nPayment details required:\n- booking_id: رقم الحجز\n- payment_method: طريقة الدفع (Visa, Mastercard, Mada)\n- card_number: رقم البطاقة (16 digits)\n- card_holder_name: اسم حامل البطاقة\n- expiry_date: تاريخ انتهاء الصلاحية (MM/YY)\n- cvv: رمز الأمان (3-4 digits)","operationId":"process_payment_booking_payment_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/PaymentRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/PaymentConfirmation"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/":{"get":{"tags":["Root"],"summary":"Root","description":"Root endpoint - API health check and welcome message.","operationId":"root__get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/health":{"get":{"tags":["Health"],"summary":"Health Check","description":"Health check endpoint.","operationId":"health_check_health_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}}},"components":{"schemas":{"BookingConfirmation":{"properties":{"booking_id":{"type":"string","title":"Booking Id","description":"رقم الحجز"},"status":{"type":"string","title":"Status","description":"حالة الحجز","default":"في انتظار الدفع"},"tickets":{"items":{"$ref":"#/components/schemas/IndividualTicket"},"type":"array","title":"Tickets","description":"التذاكر المنفصلة"},"total_amount":{"type":"number","title":"Total Amount","description":"المبلغ الإجمالي"},"booking_datetime":{"type":"string","format":"date-time","title":"Booking Datetime","description":"تاريخ ووقت الحجز"},"payment_status":{"type":"string","title":"Payment Status","description":"حالة الدفع","default":"في انتظار الدفع"},"message":{"type":"string","title":"Message","description":"الرسالة","default":"تم إنشاء الحجز بنجاح - في انتظار الدفع"}},"type":"object","required":["booking_id","tickets","total_amount","booking_datetime"],"title":"BookingConfirmation","example":{"booking_datetime":"2025-11-11T10:30:00","booking_id":"BK20251115001","message":"تم إنشاء الحجز بنجاح - في انتظار الدفع","payment_status":"في انتظار الدفع","status":"في انتظار الدفع","tickets":[{"arrival_time":"12:30","departure_time":"08:00","from_city":{"name":"الرياض"},"passenger":{},"price":150.0,"seat_number":"A12","status":"محجوز","ticket_class":"الدرجة الاقتصادية","ticket_id":"TK20251115001","ticket_sub_class":"الدرجة الاقتصادية القياسية","to_city":{"key":"DMM","name":"الدمام"},"train_number":"TR001","travel_date":"2025-11-15"}],"total_amount":300.0}},"BookingRequest":{"properties":{"session_id":{"type":"string","title":"Session Id","description":"معرف الجلسة - Session ID"},"train_id":{"type":"string","title":"Train Id","description":"معرف القطار - Train ID"},"ticket_class":{"$ref":"#/components/schemas/TicketClass","description":"الدرجة الرئيسية - Main class"},"ticket_sub_class":{"$ref":"#/components/schemas/TicketSubClass","description":"الدرجة الفرعية - Sub class"},"passengers":{"items":{"$ref":"#/components/schemas/PassengerInfo"},"type":"array","minItems":1,"title":"Passengers","description":"بيانات الركاب - Passenger data"}},"type":"object","required":["session_id","train_id","ticket_class","ticket_sub_class","passengers"],"title":"BookingRequest","example":{"passengers":[{"date_of_birth":"1990-01-01","email":"ahmed@example.com","full_name":"أحمد محمد علي","mobile_number":"+966501234567","national_id":"1234567890","nationality":"المملكة العربية السعودية","passenger_type":"بالغ","title":"السيد"}],"session_id":"SES20251112001","ticket_class":"الدرجة الاقتصادية","ticket_sub_class":"الدرجة الاقتصادية القياسية","train_id":"TR001_2025-11-15"}},"CityEnum":{"type":"string","enum":["الرياض","الهفوف","بقيق","الدمام","المجمعة","القصيم","حائل","الجوف","القريات"],"title":"CityEnum","description":"قائمة المدن المتاحة - Available Cities"},"CityInfo":{"properties":{"name":{"type":"string","title":"Name","description":"اسم المدينة بالعربي"},"key":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Key","description":"رمز المدينة"}},"type":"object","required":["name"],"title":"CityInfo","example":{"key":"DMM","name":"الدمام"}},"CityRoutesResponse":{"properties":{"from_cities":{"items":{"type":"string"},"type":"array","title":"From Cities"},"available_destinations":{"anyOf":[{"additionalProperties":{"items":{"type":"string"},"type":"array"},"type":"object"},{"type":"null"}],"title":"Available Destinations"}},"type":"object","required":["from_cities"],"title":"CityRoutesResponse"},"HTTPValidationError":{"properties":{"detail":{"items":{"$ref":"#/components/schemas/ValidationError"},"type":"array","title":"Detail"}},"type":"object","title":"HTTPValidationError"},"IndividualTicket":{"properties":{"ticket_id":{"type":"string","title":"Ticket Id","description":"رقم التذكرة"},"passenger":{"$ref":"#/components/schemas/PassengerInfo","description":"بيانات الراكب"},"train_number":{"type":"string","title":"Train Number","description":"رقم القطار"},"from_city":{"$ref":"#/components/schemas/CityInfo","description":"من"},"to_city":{"$ref":"#/components/schemas/CityInfo","description":"إلى"},"departure_time":{"type":"string","title":"Departure Time","description":"وقت المغادرة"},"arrival_time":{"type":"string","title":"Arrival Time","description":"وقت الوصول"},"travel_date":{"type":"string","format":"date","title":"Travel Date","description":"تاريخ السفر"},"ticket_class":{"type":"string","title":"Ticket Class","description":"الدرجة الرئيسية"},"ticket_sub_class":{"type":"string","title":"Ticket Sub Class","description":"الدرجة الفرعية"},"seat_number":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Seat Number","description":"رقم المقعد"},"price":{"type":"number","title":"Price","description":"سعر التذكرة"},"status":{"type":"string","title":"Status","description":"حالة التذكرة","default":"محجوز"}},"type":"object","required":["ticket_id","passenger","train_number","from_city","to_city","departure_time","arrival_time","travel_date","ticket_class","ticket_sub_class","price"],"title":"IndividualTicket","description":"تذكرة منفصلة لكل راكب"},"PassengerInfo":{"properties":{"title":{"$ref":"#/components/schemas/PassengerTitle","description":"اللقب"},"full_name":{"type":"string","minLength":2,"title":"Full Name","description":"الاسم الكامل"},"passenger_type":{"$ref":"#/components/schemas/PassengerType","description":"نوع الراكب"},"national_id":{"type":"string","title":"National Id","description":"رقم الهوية أو جواز السفر"},"date_of_birth":{"type":"string","format":"date","title":"Date Of Birth","description":"تاريخ الميلاد"},"nationality":{"type":"string","title":"Nationality","description":"الجنسية"},"email":{"type":"string","format":"email","title":"Email","description":"البريد الإلكتروني"},"mobile_number":{"type":"string","pattern":"^\\+?[0-9]{10,15}$","title":"Mobile Number","description":"رقم الجوال"}},"type":"object","required":["title","full_name","passenger_type","national_id","date_of_birth","nationality","email","mobile_number"],"title":"PassengerInfo","example":{"date_of_birth":"1990-01-01","email":"ahmed@example.com","full_name":"أحمد محمد علي","mobile_number":"+966501234567","national_id":"1234567890","nationality":"المملكة العربية السعودية","passenger_type":"بالغ","title":"السيد"}},"PassengerTitle":{"type":"string","enum":["السيد","السيدة","الآنسة","الدكتور"],"title":"PassengerTitle"},"PassengerType":{"type":"string","enum":["بالغ","طفل","رضيع"],"title":"PassengerType"},"PaymentConfirmation":{"properties":{"payment_id":{"type":"string","title":"Payment Id","description":"رقم عملية الدفع"},"booking_id":{"type":"string","title":"Booking Id","description":"رقم الحجز"},"amount":{"type":"number","title":"Amount","description":"المبلغ المدفوع"},"payment_method":{"type":"string","title":"Payment Method","description":"طريقة الدفع"},"payment_datetime":{"type":"string","format":"date-time","title":"Payment Datetime","description":"تاريخ ووقت الدفع"},"status":{"type":"string","title":"Status","description":"حالة الدفع","default":"تم الدفع بنجاح"},"tickets":{"items":{"$ref":"#/components/schemas/IndividualTicket"},"type":"array","title":"Tickets","description":"التذاكر المؤكدة"},"message":{"type":"string","title":"Message","description":"الرسالة","default":"تم الدفع بنجاح - تم تأكيد جميع التذاكر"}},"type":"object","required":["payment_id","booking_id","amount","payment_method","payment_datetime","tickets"],"title":"PaymentConfirmation","example":{"amount":300.0,"booking_id":"BK20251115001","message":"تم الدفع بنجاح - تم تأكيد جميع التذاكر","payment_datetime":"2025-11-11T10:35:00","payment_id":"PAY20251115001","payment_method":"Visa","status":"تم الدفع بنجاح","tickets":[]}},"PaymentRequest":{"properties":{"booking_id":{"type":"string","title":"Booking Id","description":"رقم الحجز"},"payment_method":{"type":"string","title":"Payment Method","description":"طريقة الدفع (Visa, Mastercard, Mada)"},"card_number":{"type":"string","pattern":"^\\d{16}$","title":"Card Number","description":"رقم البطاقة"},"card_holder_name":{"type":"string","title":"Card Holder Name","description":"اسم حامل البطاقة"},"expiry_date":{"type":"string","pattern":"^\\d{2}/\\d{2}$","title":"Expiry Date","description":"تاريخ انتهاء الصلاحية (MM/YY)"},"cvv":{"type":"string","pattern":"^\\d{3,4}$","title":"Cvv","description":"رمز الأمان"}},"type":"object","required":["booking_id","payment_method","card_number","card_holder_name","expiry_date","cvv"],"title":"PaymentRequest","example":{"booking_id":"BK20251115001","card_holder_name":"Ahmed Mohammed Ali","card_number":"4111111111111111","cvv":"123","expiry_date":"12/26","payment_method":"Visa"}},"SearchRequest":{"properties":{"from_city":{"$ref":"#/components/schemas/CityEnum","description":"مدينة المغادرة - Origin city"},"to_city":{"$ref":"#/components/schemas/CityEnum","description":"مدينة الوصول - Destination city"},"travel_date":{"type":"string","format":"date","title":"Travel Date","description":"تاريخ السفر - Travel date"},"adults":{"type":"integer","minimum":0.0,"title":"Adults","description":"عدد البالغين - Number of adults","default":1},"children":{"type":"integer","minimum":0.0,"title":"Children","description":"عدد الأطفال - Number of children","default":0},"infants":{"type":"integer","minimum":0.0,"title":"Infants","description":"عدد الرضع - Number of infants","default":0}},"type":"object","required":["from_city","to_city","travel_date"],"title":"SearchRequest","example":{"adults":2,"children":1,"from_city":"الرياض","infants":0,"to_city":"الدمام","travel_date":"2025-11-15"}},"TicketClass":{"type":"string","enum":["الدرجة الاقتصادية","درجة الأعمال","الكبائن الخاصة"],"title":"TicketClass"},"TicketSubClass":{"type":"string","enum":["الدرجة الاقتصادية الموفرة","الدرجة الاقتصادية القياسية","درجة الأعمال","درجة الأعمال الممتازة","الكبائن الخاصة"],"title":"TicketSubClass"},"ValidationError":{"properties":{"loc":{"items":{"anyOf":[{"type":"string"},{"type":"integer"}]},"type":"array","title":"Location"},"msg":{"type":"string","title":"Message"},"type":{"type":"string","title":"Error Type"}},"type":"object","required":["loc","msg","type"],"title":"ValidationError"}}}}